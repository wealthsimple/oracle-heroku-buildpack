#!/usr/bin/env ruby

require 'tempfile'
require 'fileutils'

$stdout.sync = true

def indent msg
  puts "       #{msg}"
end

puts "-----> Found a .oracle.ini"

RUBY=`which ruby`

puts "ruby is #{RUBY}"
puts "ARGV[0] = #{ARGV[0]}"


ORACLE_INSTANT_CLIENT_DIR="#{ARGV[0]}/vendor/oracle_instantclient"
ORACLE_INSTANT_CLIENT_TGZ="https://www.dropbox.com/s/aovobyzkqfamdxz/instantclient-full-linux.x64-12.1.0.2.0.tar.gz"

indent "Making directoires..."
`mkdir -p #{ORACLE_INSTANT_CLIENT_DIR}`

indent "Downloading and extracting instantclient"
result = `curl #{ORACLE_INSTANT_CLIENT_TGZ} -L -o - | tar -xvz -C #{ORACLE_INSTANT_CLIENT_DIR} -f - `

unless $?.success?
  indent "Failure while downloading Oracle instant client archive: #{$?}"
  exit 1
end

indent "Successfully extracted #{ORACLE_INSTANT_CLIENT_TGZ} to #{ORACLE_INSTANT_CLIENT_DIR}"
indent "Done!"
